<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Easy WebAuthn Demo</title>
</head>
<body>
  <h1>ğŸ” WebAuthn Demo</h1>
  <button id="registerBtn">Register</button>
  <button id="loginBtn">Login</button>

  <script>
    // Convert string to ArrayBuffer
    const strToBuf = (str) => new TextEncoder().encode(str);

    let savedCredentialId = null;

    // ğŸ” Register Credential
    document.getElementById("registerBtn").onclick = async () => {
      const publicKey = {
        challenge: strToBuf("random-challenge"),
        rp: { name: "My Demo App" },
        user: {
          id: strToBuf("user-id"),
          name: "user@example.com",
          displayName: "Test User"
        },
        pubKeyCredParams: [{ type: "public-key", alg: -7 }] // ES256
      };

      try {
        const cred = await navigator.credentials.create({ publicKey });
        savedCredentialId = cred.rawId;
        alert("âœ… Registered successfully!");
        console.log("Credential:", cred);
      } catch (err) {
        alert("âŒ Registration failed");
        console.error(err);
      }
    };

    // ğŸ”‘ Login (Get Assertion)
    document.getElementById("loginBtn").onclick = async () => {
      if (!savedCredentialId) return alert("â— Register first!");

      const publicKey = {
        challenge: strToBuf("random-challenge"),
        allowCredentials: [
          {
            id: savedCredentialId,
            type: "public-key"
          }
        ]
      };

      try {
        const assertion = await navigator.credentials.get({ publicKey });
        alert("âœ… Login successful!");
        console.log("Assertion:", assertion);
      } catch (err) {
        alert("âŒ Login failed");
        console.error(err);
      }
    };
  </script>
</body>
</html>
